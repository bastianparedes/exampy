<div class="tw-px-2 md:tw-px-5">
  <h1 class="tw-text-6xl tw-text-center tw-my-10">
    {{ 'createExam.title' | translate }}
  </h1>
  <p class="tw-mb-3">{{ 'createExam.description1' | translate }}</p>
  <p>{{ 'createExam.description2' | translate }}</p>
  <form
    class="tw-flex tw-flex-col tw-py-5 tw-gap-4"
    [formGroup]="this.examDataForm"
    (submit)="createTest($event)">
    <div
      class="tw-relative tw-h-10 tw-flex tw-justify-around tw-text-white tw-text-xs sm:tw-text-base sm:tw-h-12">
      <p-button
        [disabled]="this.isCreatingPdf"
        [label]="'createExam.loadExample' | translate"
        (click)="this.setExample()" />
    </div>
    <div class="tw-flex tw-gap-4 tw-flex-col-reverse lg:tw-flex-row">
      <div
        formGroupName="exercises"
        class="tw-flex tw-flex-1 tw-flex-col tw-gap-8">
        @for (section of this.sections; track section) {
          <section
            formArrayName="{{ section }}"
            class="tw-bg-white tw-px-7 tw-pb-3 tw-shadow-gray-500 tw-shadow-md">
            <h2 class="tw-mb-3 tw-text-2xl">
              {{ 'createExam.' + section | translate }}
            </h2>
            @if (this.getSectionArray(section).controls.length > 0) {
              <div class="tw-flex tw-flex-col tw-gap-10 tw-mt-8 md:tw-gap-8">
                @for (
                  exercise of this.getSectionArray(section).controls;
                  track exercise
                ) {
                  <div formGroupName="{{ $index }}">
                    <div
                      class="tw-py-0 tw-px-0 tw-flex tw-flex-col tw-gap-7 md:tw-flex-row md:tw-gap-5">
                      <p-floatLabel class="tw-flex-1">
                        <input
                          class="tw-w-full"
                          pInputText
                          maxlength="200"
                          id="description"
                          formControlName="description"
                          [placeholder]="'createExam.example' | translate" />
                        <label for="description">{{
                          'createExam.description' | translate
                        }}</label>
                      </p-floatLabel>

                      <div class="tw-flex tw-justify-between tw-gap-5">
                        <p-floatLabel class="tw-flex-1 md:tw-w-24">
                          <p-inputNumber
                            inputStyleClass="tw-w-full"
                            inputId="minmax"
                            formControlName="quantity"
                            [min]="1"
                            [max]="10" />
                          <label for="description">{{
                            'createExam.quantity' | translate
                          }}</label>
                        </p-floatLabel>

                        <p-button
                          icon="pi pi-times"
                          severity="danger"
                          (click)="deleteRow(section, $index)" />
                      </div>
                    </div>
                  </div>
                }
              </div>
            }

            <p-button
              styleClass="tw-mt-4"
              [label]="'createExam.addRow' | translate"
              (click)="this.addRow(section)" />
          </section>
        }
      </div>
      <aside
        class="tw-h-fit tw-rounded-md tw-bg-white tw-p-5 tw-shadow-gray-500 tw-shadow-md lg:tw-w-80">
        <div class="tw-relative tw-flex tw-flex-col tw-gap-5">
          <p-dropdown
            class="tw-w-full"
            formControlName="subject"
            [options]="this.subjectsTranslated"
            optionLabel="label"
            optionValue="value"
            placeholder="{{ 'createExam.subject' | translate }}" />

          <div class="tw-flex tw-items-center tw-gap-1">
            <p-checkbox
              formControlName="includeAnswers"
              [binary]="true"
              inputId="includeAnswers" />
            <label for="includeAnswers">{{
              'createExam.includeAnswers' | translate
            }}</label>
          </div>

          <p-button
            [label]="
              'createExam.' +
                (this.isCreatingPdf ? 'creatingExam' : 'createExam') | translate
            "
            [loading]="this.isCreatingPdf"
            type="submit"
            class="tw-mx-auto"
            [disabled]="!this.getExamCanBeCreated()" />
        </div>
      </aside>
    </div>
  </form>
  <div id="exam-pdf">
    @if (this.pdfUrl !== undefined || this.isCreatingPdf) {
      <div class="tw-w-full tw-px-5 tw-flex tw-justify-center">
        <div class="tw-p-8">
          <div class="tw-relative tw-w-96 tw-h-48">
            @if (this.isCreatingPdf) {
              <p-skeleton width="100%" height="100%" />
            } @else if (this.pdfUrl !== undefined) {
              <a class="open-document" [href]="this.pdfUrl" target="_blank">{{
                'createExam.openDocument' | translate
              }}</a>
            }
          </div>
        </div>
      </div>
    }
  </div>
</div>
<p-toast />
